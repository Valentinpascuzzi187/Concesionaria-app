<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minuta de Venta - Concesionaria</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            border-bottom: 3px solid #667eea;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .section-title {
            color: #667eea;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            font-size: 14px;
        }

        input, select, textarea {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            background: #f0f4ff;
        }

        input:disabled, select:disabled, textarea:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
            color: #999;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .firma-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .firma-box {
            text-align: center;
        }

        .firma-line {
            border-top: 2px solid #333;
            margin-bottom: 10px;
            margin-top: 60px;
        }

        .firma-label {
            font-weight: bold;
            color: #333;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .estado-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .estado-borrador {
            background: #ffc107;
            color: #000;
        }

        .estado-confirmada {
            background: #28a745;
            color: white;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                padding: 20px;
            }

            .button-container {
                display: none;
            }

            .alert {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .firma-section {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .container {
                padding: 20px;
            }
        }

        .required::after {
            content: " *";
            color: red;
        }

        .info-text {
            font-size: 12px;
            color: #666;
            font-style: italic;
            margin-top: 5px;
        }

        .total-box {
            background: #667eea;
            color: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã MINUTA DE VENTA DE VEH√çCULO</h1>
            <p>Documento legal de compraventa</p>
            <span id="estadoBadge" class="estado-badge estado-borrador">BORRADOR</span>
        </div>

        <div id="alertContainer"></div>

        <form id="minutaForm">
            <!-- Secci√≥n 1: Lugar y Fecha -->
            <div class="section">
                <div class="section-title">üìç 1. LUGAR Y FECHA</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Lugar</label>
                        <input type="text" id="lugar" placeholder="Ej: Ciudad de Buenos Aires" required disabled>
                    </div>
                    <div class="form-group">
                        <label class="required">Fecha</label>
                        <input type="date" id="fecha" required disabled>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 2: Datos del Comprador -->
            <div class="section">
                <div class="section-title">üë§ 2. DATOS DEL COMPRADOR</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Nombre Completo</label>
                        <input type="text" id="compradorNombre" placeholder="Nombre y Apellido" required disabled>
                    </div>
                    <div class="form-group">
                        <label class="required">DNI</label>
                        <input type="text" id="compradorDni" placeholder="12.345.678" required disabled>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Domicilio</label>
                        <input type="text" id="compradorDomicilio" placeholder="Calle, N√∫mero, Localidad" required disabled>
                    </div>
                    <div class="form-group">
                        <label class="required">Tel√©fono</label>
                        <input type="tel" id="compradorTelefono" placeholder="11-1234-5678" required disabled>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="compradorEmail" placeholder="comprador@ejemplo.com" disabled>
                    </div>
                    <div class="form-group">
                        <label>CUIL/CUIT</label>
                        <input type="text" id="compradorCuil" placeholder="20-12345678-9" disabled>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 3: Datos del Vendedor -->
            <div class="section">
                <div class="section-title">üè¢ 3. DATOS DEL VENDEDOR (CONCESIONARIA)</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Raz√≥n Social</label>
                        <input type="text" id="vendedorRazon" placeholder="Nombre de la Concesionaria" required disabled>
                    </div>
                    <div class="form-group">
                        <label class="required">CUIT</label>
                        <input type="text" id="vendedorCuit" placeholder="30-12345678-9" required disabled>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Domicilio Comercial</label>
                        <input type="text" id="vendedorDomicilio" placeholder="Direcci√≥n de la concesionaria" required disabled>
                    </div>
                    <div class="form-group">
                        <label>Responsable de Venta</label>
                        <input type="text" id="vendedorResponsable" placeholder="Nombre del vendedor" disabled>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 4: Datos del Veh√≠culo -->
            <div class="section">
                <div class="section-title">üöó 4. DATOS DEL VEH√çCULO</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Tipo</label>
                        <select id="vehiculoTipo" required disabled>
                            <option value="">Seleccionar...</option>
                            <option value="auto">Autom√≥vil</option>
                            <option value="moto">Motocicleta</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="required">Condici√≥n</label>
                        <select id="vehiculoCondicion" required disabled>
                            <option value="">Seleccionar...</option>
                            <option value="0km">0 Km (Nuevo)</option>
                            <option value="usado">Usado</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Marca</label>
                        <input type="text" id="vehiculoMarca" placeholder="Ej: Toyota" required disabled>
                    </div>
                    <div class="form-group">
                        <label class="required">Modelo</label>
                        <input type="text" id="vehiculoModelo" placeholder="Ej: Corolla" required disabled>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Versi√≥n</label>
                        <input type="text" id="vehiculoVersion" placeholder="Ej: XEI 2.0" disabled>
                    </div>
                    <div class="form-group">
                        <label class="required">A√±o</label>
                        <input type="number" id="vehiculoAnio" placeholder="2024" required disabled>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label id="labelDominio">Dominio/Patente</label>
                        <input type="text" id="vehiculoDominio" placeholder="ABC123" disabled>
                    </div>
                    <div class="form-group">
                        <label>N√∫mero de Motor</label>
                        <input type="text" id="vehiculoMotor" placeholder="N√∫mero de motor" disabled>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>N√∫mero de Chasis</label>
                        <input type="text" id="vehiculoChasis" placeholder="N√∫mero de chasis" disabled>
                    </div>
                    <div class="form-group">
                        <label>Color</label>
                        <input type="text" id="vehiculoColor" placeholder="Ej: Blanco" disabled>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 5: Condiciones de la Operaci√≥n -->
            <div class="section">
                <div class="section-title">üí∞ 5. CONDICIONES DE LA OPERACI√ìN</div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Precio de Lista</label>
                        <input type="number" id="precioLista" placeholder="0.00" step="0.01" required disabled>
                        <span class="info-text">Precio original del veh√≠culo</span>
                    </div>
                    <div class="form-group">
                        <label>Descuento</label>
                        <input type="number" id="descuento" placeholder="0.00" step="0.01" value="0" disabled>
                        <span class="info-text">Descuento aplicado (si corresponde)</span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Modalidad de Pago</label>
                        <select id="modalidadPago" required disabled>
                            <option value="">Seleccionar...</option>
                            <option value="contado">Contado</option>
                            <option value="financiado">Financiado</option>
                            <option value="permuta">Permuta</option>
                            <option value="mixto">Mixto (Permuta + Financiaci√≥n)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="required">Anticipo/Se√±a</label>
                        <input type="number" id="anticipo" placeholder="0.00" step="0.01" value="0" required disabled>
                        <span class="info-text">Monto entregado como se√±a</span>
                    </div>
                </div>

                <!-- Datos de Permuta (si aplica) -->
                <div id="permutaSection" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Veh√≠culo en Permuta</label>
                            <input type="text" id="permutaVehiculo" placeholder="Marca, Modelo, A√±o" disabled>
                        </div>
                        <div class="form-group">
                            <label>Valor de Permuta</label>
                            <input type="number" id="permutaValor" placeholder="0.00" step="0.01" value="0" disabled>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Dominio Permuta</label>
                            <input type="text" id="permutaDominio" placeholder="ABC123" disabled>
                        </div>
                        <div class="form-group">
                            <label>Estado del Veh√≠culo en Permuta</label>
                            <input type="text" id="permutaEstado" placeholder="Ej: Muy bueno" disabled>
                        </div>
                    </div>
                </div>

                <!-- Datos de Financiaci√≥n (si aplica) -->
                <div id="financiacionSection" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Cantidad de Cuotas</label>
                            <input type="number" id="cuotas" placeholder="12" disabled>
                        </div>
                        <div class="form-group">
                            <label>Valor de Cuota</label>
                            <input type="number" id="valorCuota" placeholder="0.00" step="0.01" disabled>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Entidad Financiera</label>
                            <input type="text" id="entidadFinanciera" placeholder="Nombre del banco/financiera" disabled>
                        </div>
                        <div class="form-group">
                            <label>Tasa de Inter√©s (%)</label>
                            <input type="number" id="tasaInteres" placeholder="0.00" step="0.01" disabled>
                        </div>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label class="required">Saldo a Financiar / Pagar</label>
                    <input type="number" id="saldoPagar" placeholder="0.00" step="0.01" required disabled>
                    <span class="info-text">Monto restante despu√©s de anticipo y/o permuta</span>
                </div>

                <div class="total-box">
                    <div>PRECIO FINAL DE VENTA</div>
                    <div id="precioFinalDisplay">$ 0.00</div>
                </div>
            </div>

            <!-- Secci√≥n 6: Observaciones y Condiciones Especiales -->
            <div class="section">
                <div class="section-title">üìù 6. OBSERVACIONES Y CONDICIONES ESPECIALES</div>
                <div class="form-group full-width">
                    <label>Observaciones</label>
                    <textarea id="observaciones" placeholder="Detalles adicionales, accesorios incluidos, condiciones especiales, etc." disabled></textarea>
                </div>
                <div class="form-group full-width">
                    <label>Fecha de Entrega Estimada</label>
                    <input type="date" id="fechaEntrega" disabled>
                </div>
            </div>

            <!-- Secci√≥n 7: Declaraciones -->
            <div class="section">
                <div class="section-title">‚öñÔ∏è 7. DECLARACIONES</div>
                <p style="line-height: 1.8; color: #555; font-size: 14px;">
                    Ambas partes declaran:<br><br>
                    <strong>a)</strong> Que el presente documento constituye un acuerdo de compraventa vinculante entre las partes.<br>
                    <strong>b)</strong> Que el comprador ha verificado el estado del veh√≠culo y lo acepta en las condiciones actuales.<br>
                    <strong>c)</strong> Que el vendedor garantiza que el veh√≠culo se encuentra libre de deudas, prendas o grav√°menes.<br>
                    <strong>d)</strong> Que los datos consignados son correctos y completos.<br>
                    <strong>e)</strong> Que la transferencia de dominio se realizar√° dentro de los plazos legales establecidos.<br>
                    <strong>f)</strong> Que los gastos de transferencia corren por cuenta del <strong id="responsableGastos">comprador</strong>.<br>
                </p>
                <div class="form-group full-width" style="margin-top: 15px;">
                    <label>Responsable de Gastos de Transferencia</label>
                    <select id="gastosTransferencia" disabled>
                        <option value="comprador">Comprador</option>
                        <option value="vendedor">Vendedor</option>
                        <option value="compartido">Compartido (50/50)</option>
                    </select>
                </div>
            </div>

            <!-- Firmas -->
            <div class="firma-section">
                <div class="firma-box">
                    <div class="firma-line"></div>
                    <div class="firma-label">FIRMA DEL COMPRADOR</div>
                    <p style="margin-top: 10px; font-size: 14px;" id="nombreCompradorFirma">_______________</p>
                    <p style="font-size: 12px; color: #666;" id="dniCompradorFirma">DNI: _______________</p>
                </div>
                <div class="firma-box">
                    <div class="firma-line"></div>
                    <div class="firma-label">FIRMA DEL VENDEDOR</div>
                    <p style="margin-top: 10px; font-size: 14px;" id="nombreVendedorFirma">_______________</p>
                    <p style="font-size: 12px; color: #666;">Concesionaria</p>
                </div>
            </div>
        </form>

        <!-- Botones de Acci√≥n -->
        <div class="button-container">
            <button type="button" class="btn btn-primary" id="btnCompletar">
                ‚úèÔ∏è Completar Minuta
            </button>
            <button type="button" class="btn btn-success" id="btnConfirmar" disabled>
                ‚úÖ Confirmar Minuta
            </button>
            <button type="button" class="btn btn-secondary" id="btnImprimir" disabled>
                üñ®Ô∏è Imprimir
            </button>
            <button type="button" class="btn btn-secondary" id="btnVolver">
                ‚Üê Volver
            </button>
        </div>
    </div>

    <script>
        // Estado de la minuta
        let minutaEstado = 'borrador'; // 'borrador', 'confirmada'
        let formHabilitado = false;

        // Referencias a elementos
        const form = document.getElementById('minutaForm');
        const btnCompletar = document.getElementById('btnCompletar');
        const btnConfirmar = document.getElementById('btnConfirmar');
        const btnImprimir = document.getElementById('btnImprimir');
        const btnVolver = document.getElementById('btnVolver');
        const estadoBadge = document.getElementById('estadoBadge');
        const alertContainer = document.getElementById('alertContainer');

        // Inicializar fecha actual
        document.getElementById('fecha').value = new Date().toISOString().split('T')[0];

        // Funci√≥n para mostrar alertas
        function mostrarAlerta(mensaje, tipo = 'success') {
            alertContainer.innerHTML = `
                <div class="alert alert-${tipo}">
                    ${mensaje}
                </div>
            `;
            alertContainer.querySelector('.alert').style.display = 'block';
            
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        // Habilitar/Deshabilitar campos del formulario
        function toggleFormulario(habilitar) {
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.disabled = !habilitar;
            });
            formHabilitado = habilitar;
        }

        // Bot√≥n Completar Minuta
        btnCompletar.addEventListener('click', () => {
            if (minutaEstado === 'confirmada') {
                mostrarAlerta('‚ö†Ô∏è La minuta ya est√° confirmada y no puede editarse.', 'warning');
                return;
            }

            toggleFormulario(true);
            btnConfirmar.disabled = false;
            btnCompletar.textContent = '‚úèÔ∏è Editando...';
            btnCompletar.disabled = true;
            mostrarAlerta('‚úÖ Formulario habilitado. Complete todos los campos obligatorios (*)', 'success');
        });

        // Validar formulario
        function validarFormulario() {
            const camposRequeridos = form.querySelectorAll('[required]');
            const camposVacios = [];

            camposRequeridos.forEach(campo => {
                if (!campo.value.trim()) {
                    camposVacios.push(campo.previousElementSibling.textContent.replace('*', '').trim());
                    campo.style.borderColor = 'red';
                } else {
                    campo.style.borderColor = '#e0e0e0';
                }
            });

            return camposVacios;
        }

        // Calcular precio final
        function calcularPrecioFinal() {
            const precioLista = parseFloat(document.getElementById('precioLista').value) || 0;
            const descuento = parseFloat(document.getElementById('descuento').value) || 0;
            const precioFinal = precioLista - descuento;
            
            document.getElementById('precioFinalDisplay').textContent = 
                `$ ${precioFinal.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            
            // Calcular saldo
            const anticipo = parseFloat(document.getElementById('anticipo').value) || 0;
            const permutaValor = parseFloat(document.getElementById('permutaValor').value) || 0;
            const saldo = precioFinal - anticipo - permutaValor;
            document.getElementById('saldoPagar').value = saldo.toFixed(2);
        }

        // Listeners para c√°lculos autom√°ticos
        ['precioLista', 'descuento', 'anticipo', 'permutaValor'].forEach(id => {
            document.getElementById(id).addEventListener('input', calcularPrecioFinal);
        });

        // Mostrar/ocultar secciones seg√∫n modalidad de pago
        document.getElementById('modalidadPago').addEventListener('change', (e) => {
            const modalidad = e.target.value;
            const permutaSection = document.getElementById('permutaSection');
            const financiacionSection = document.getElementById('financiacionSection');

            permutaSection.style.display = 'none';
            financiacionSection.style.display = 'none';

            if (modalidad === 'permuta' || modalidad === 'mixto') {
                permutaSection.style.display = 'block';
            }
            if (modalidad === 'financiado' || modalidad === 'mixto') {
                financiacionSection.style.display = 'block';
            }
        });

        // Actualizar label de dominio seg√∫n condici√≥n
        document.getElementById('vehiculoCondicion').addEventListener('change', (e) => {
            const labelDominio = document.getElementById('labelDominio');
            const inputDominio = document.getElementById('vehiculoDominio');
            
            if (e.target.value === 'usado') {
                labelDominio.classList.add('required');
                inputDominio.required = true;
            } else {
                labelDominio.classList.remove('required');
                inputDominio.required = false;
            }
        });

        // Actualizar responsable de gastos en declaraciones
        document.getElementById('gastosTransferencia').addEventListener('change', (e) => {
            document.getElementById('responsableGastos').textContent = e.target.value;
        });

        // Actualizar nombres en firmas
        document.getElementById('compradorNombre').addEventListener('input', (e) => {
            document.getElementById('nombreCompradorFirma').textContent = e.target.value || '_______________';
        });

        document.getElementById('compradorDni').addEventListener('input', (e) => {
            document.getElementById('dniCompradorFirma').textContent = 
                e.target.value ? `DNI: ${e.target.value}` : 'DNI: _______________';
        });

        document.getElementById('vendedorRazon').addEventListener('input', (e) => {
            document.getElementById('nombreVendedorFirma').textContent = e.target.value || '_______________';
        });

        // Bot√≥n Confirmar Minuta
        btnConfirmar.addEventListener('click', () => {
            const camposVacios = validarFormulario();

            if (camposVacios.length > 0) {
                mostrarAlerta(
                    `‚ö†Ô∏è Por favor complete los siguientes campos obligatorios:<br>‚Ä¢ ${camposVacios.join('<br>‚Ä¢ ')}`,
                    'error'
                );
                return;
            }

            // Confirmar acci√≥n
            if (!confirm('¬øEst√° seguro de confirmar la minuta? Una vez confirmada no podr√° editarse.')) {
                return;
            }

            // Bloquear formulario
            toggleFormulario(false);
            minutaEstado = 'confirmada';
            estadoBadge.textContent = 'CONFIRMADA';
            estadoBadge.className = 'estado-badge estado-confirmada';
            
            btnConfirmar.disabled = true;
            btnCompletar.disabled = true;
            btnImprimir.disabled = false;

            mostrarAlerta('‚úÖ Minuta confirmada exitosamente. Ya puede imprimirla o exportarla.', 'success');

            // Aqu√≠ puedes agregar l√≥gica para guardar en la base de datos
            guardarMinuta();
        });

        // Funci√≥n para guardar minuta (conectar con backend)
        async function guardarMinuta() {
            const minutaData = {
                // Lugar y fecha
                lugar: document.getElementById('lugar').value,
                fecha: document.getElementById('fecha').value,
                
                // Comprador
                comprador: {
                    nombre: document.getElementById('compradorNombre').value,
                    dni: document.getElementById('compradorDni').value,
                    domicilio: document.getElementById('compradorDomicilio').value,
                    telefono: document.getElementById('compradorTelefono').value,
                    email: document.getElementById('compradorEmail').value,
                    cuil: document.getElementById('compradorCuil').value
                },
                
                // Vendedor
                vendedor: {
                    razon: document.getElementById('vendedorRazon').value,
                    cuit: document.getElementById('vendedorCuit').value,
                    domicilio: document.getElementById('vendedorDomicilio').value,
                    responsable: document.getElementById('vendedorResponsable').value
                },
                
                // Veh√≠culo
                vehiculo: {
                    tipo: document.getElementById('vehiculoTipo').value,
                    condicion: document.getElementById('vehiculoCondicion').value,
                    marca: document.getElementById('vehiculoMarca').value,
                    modelo: document.getElementById('vehiculoModelo').value,
                    version: document.getElementById('vehiculoVersion').value,
                    anio: document.getElementById('vehiculoAnio').value,
                    dominio: document.getElementById('vehiculoDominio').value,
                    motor: document.getElementById('vehiculoMotor').value,
                    chasis: document.getElementById('vehiculoChasis').value,
                    color: document.getElementById('vehiculoColor').value
                },
                
                // Operaci√≥n
                operacion: {
                    precioLista: document.getElementById('precioLista').value,
                    descuento: document.getElementById('descuento').value,
                    modalidadPago: document.getElementById('modalidadPago').value,
                    anticipo: document.getElementById('anticipo').value,
                    saldoPagar: document.getElementById('saldoPagar').value,
                    permuta: {
                        vehiculo: document.getElementById('permutaVehiculo').value,
                        valor: document.getElementById('permutaValor').value,
                        dominio: document.getElementById('permutaDominio').value,
                        estado: document.getElementById('permutaEstado').value
                    },
                    financiacion: {
                        cuotas: document.getElementById('cuotas').value,
                        valorCuota: document.getElementById('valorCuota').value,
                        entidad: document.getElementById('entidadFinanciera').value,
                        tasa: document.getElementById('tasaInteres').value
                    }
                },
                
                // Otros
                observaciones: document.getElementById('observaciones').value,
                fechaEntrega: document.getElementById('fechaEntrega').value,
                gastosTransferencia: document.getElementById('gastosTransferencia').value,
                estado: minutaEstado,
                usuario_id: localStorage.getItem('userId') || 1
            };

            try {
                const serverURL = 'https://concesionaria-app-production.up.railway.app';
                const response = await fetch(`${serverURL}/api/minutas/detallada`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(minutaData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    console.log('‚úÖ Minuta guardada en el servidor:', result);
                    localStorage.setItem('ultimaMinutaId', result.minuta_id);
                } else {
                    console.error('‚ùå Error al guardar minuta:', result.message);
                }
            } catch (error) {
                console.error('‚ùå Error de conexi√≥n:', error);
            }
        }

        // Bot√≥n Imprimir
        btnImprimir.addEventListener('click', () => {
            window.print();
        });

        // Bot√≥n Volver
        btnVolver.addEventListener('click', () => {
            if (minutaEstado === 'borrador' && formHabilitado) {
                if (!confirm('Tiene cambios sin confirmar. ¬øDesea salir de todos modos?')) {
                    return;
                }
            }
            window.history.back();
        });
    </script>
</body>
</html>
