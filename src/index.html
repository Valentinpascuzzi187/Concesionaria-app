<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Concesionaria - Sistema de Gesti√≥n</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- Navbar -->
    <nav class="navbar">
      <div class="navbar-brand" style="display:flex; align-items:center; gap:12px;">
        <img id="brandLogo" class="brand-logo" src="/assets/logo.png" alt="De Grazia - Automotores" onerror="this.onerror=null;this.src='/assets/logo.svg'">
        <h1>De Grazia - Automotores</h1>
      </div>
      <div class="navbar-menu">
        <button class="nav-btn" onclick="showSection('login')">Login</button>
        <button class="nav-btn" onclick="showSection('register')">Registro</button>
        <button class="nav-btn" onclick="showSection('dashboard')" style="display:none;">üìä Dashboard</button>
        <button class="nav-btn" onclick="showSection('stock')" style="display:none;">üöó Stock</button>
        <button class="nav-btn" onclick="showSection('clientes')" style="display:none;">üë• Clientes</button>
        <button class="nav-btn" onclick="showSection('minutas')" style="display:none;">üìã Minutas</button>
        <button class="nav-btn" onclick="showSection('pagos')" style="display:none;">üí∞ Pagos</button>
        <button class="nav-btn" onclick="showSection('reportes')" style="display:none;">üìà Reportes</button>
        <!-- Botones exclusivos del admin premium -->
        <button class="nav-btn premium-only" onclick="showSection('control-usuarios')" style="display:none;">üéõÔ∏è Control Usuarios</button>
        <button class="nav-btn premium-only" onclick="showSection('auditoria')" style="display:none;">üîç Auditor√≠a</button>
        <button class="nav-btn" onclick="logout()" style="display:none;">üö™ Logout</button>
      </div>
    </nav>

    <!-- Login Section -->
    <section id="login" class="section active">
      <div class="card">
        <h2>Iniciar Sesi√≥n</h2>
        <form id="loginForm">
          <div class="form-group">
            <label for="loginEmail">Email:</label>
            <input type="email" id="loginEmail" placeholder="usuario@ejemplo.com" required>
          </div>
          <div class="form-group">
            <label for="loginPassword">Contrase√±a:</label>
            <input type="password" id="loginPassword" placeholder="Contrase√±a" required>
          </div>
          <button type="submit" class="btn btn-primary">Iniciar Sesi√≥n</button>
          <div id="loginMessage" class="message"></div>
        </form>
      </div>
    </section>

    <!-- Register Section -->
    <section id="register" class="section">
      <div class="card">
        <h2>Registrarse</h2>
        <form id="registerForm">
          <div class="form-group">
            <label for="regNombre">Nombre:</label>
            <input type="text" id="regNombre" placeholder="Tu nombre" required>
          </div>
          <div class="form-group">
            <label for="regEmail">Email:</label>
            <input type="email" id="regEmail" placeholder="email@ejemplo.com" required>
          </div>
          <div class="form-group">
            <label for="regPassword">Contrase√±a:</label>
            <input type="password" id="regPassword" placeholder="Contrase√±a" required>
          </div>
          <div class="form-group">
            <label for="regRol">Rol:</label>
            <select id="regRol" required>
              <option value="vendedor">Vendedor</option>
              <option value="administrador">Administrador</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Registrarse</button>
          <div id="registerMessage" class="message"></div>
        </form>
      </div>
    </section>

    <!-- Dashboard Section -->
    <section id="dashboard" class="section">
      <div class="card">
        <h2>Dashboard</h2>
        <div class="dashboard-grid">
          <div class="stat-card">
            <h3>Veh√≠culos en Stock</h3>
            <p class="stat-number" id="stockCount">0</p>
          </div>
          <div class="stat-card">
            <h3>Minutas Activas</h3>
            <p class="stat-number" id="minutasCount">0</p>
          </div>
          <div class="stat-card">
            <h3>Clientes Registrados</h3>
            <p class="stat-number" id="clientesCount">0</p>
          </div>
          <div class="stat-card">
            <h3>Ventas del Mes</h3>
            <p class="stat-number" id="ventasCount">0</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Stock Section -->
    <section id="stock" class="section">
      <div class="card">
        <h2>Gesti√≥n de Stock</h2>
        <button class="btn btn-primary" onclick="toggleVehiculoForm()">‚ûï A√±adir Veh√≠culo</button>
        
        <div id="vehiculoForm" style="display: none; margin-top: 20px;">
          <h3>Nuevo Veh√≠culo</h3>
          <form id="vehiculoFormElement">
            <div class="form-row">
              <div class="form-group">
                <label for="tipo">Tipo:</label>
                <select id="tipo" required>
                  <option value="">Seleccionar...</option>
                  <option value="auto">Auto</option>
                  <option value="moto">Moto</option>
                </select>
              </div>
              <div class="form-group">
                <label for="condicion">Condici√≥n:</label>
                <select id="condicion" required>
                  <option value="">Seleccionar...</option>
                  <option value="0km">0 km</option>
                  <option value="usado">Usado</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="marca">Marca:</label>
                <input type="text" id="marca" placeholder="Ej: Toyota" required>
              </div>
              <div class="form-group">
                <label for="modelo">Modelo:</label>
                <input type="text" id="modelo" placeholder="Ej: Corolla" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="version">Versi√≥n:</label>
                <input type="text" id="version" placeholder="Ej: XEI">
              </div>
              <div class="form-group">
                <label for="anio">A√±o:</label>
                <input type="number" id="anio" placeholder="2024" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="precio">Precio:</label>
                <input type="number" id="precio" placeholder="25000" step="0.01" required>
              </div>
              <div class="form-group" id="dominioGroup" style="display: none;">
                <label for="dominio">Dominio:</label>
                <input type="text" id="dominio" placeholder="ABC123">
              </div>
            </div>
            <button type="submit" class="btn btn-primary">Guardar Veh√≠culo</button>
            <div id="vehiculoMessage" class="message"></div>
          </form>
        </div>

        <div id="vehiculosList" style="margin-top: 30px;">
          <h3>Veh√≠culos en Stock</h3>
          <div id="vehiculosContent"></div>
        </div>
      </div>
    </section>

    <!-- Clientes Section -->
    <section id="clientes" class="section">
      <div class="card">
        <h2>Gesti√≥n de Clientes</h2>
        <button class="btn btn-primary" onclick="toggleClienteForm()">‚ûï A√±adir Cliente</button>
        
        <div id="clienteForm" style="display: none; margin-top: 20px;">
          <h3>Nuevo Cliente</h3>
          <form id="clienteFormElement">
            <div class="form-row">
              <div class="form-group">
                <label for="cliNombre">Nombre:</label>
                <input type="text" id="cliNombre" placeholder="Juan" required>
              </div>
              <div class="form-group">
                <label for="cliApellido">Apellido:</label>
                <input type="text" id="cliApellido" placeholder="P√©rez" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="cliDni">DNI:</label>
                <input type="text" id="cliDni" placeholder="12345678" required>
              </div>
              <div class="form-group">
                <label for="cliTelefono">Tel√©fono:</label>
                <input type="tel" id="cliTelefono" placeholder="11-1234-5678">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="cliEmail">Email:</label>
                <input type="email" id="cliEmail" placeholder="cliente@ejemplo.com">
              </div>
              <div class="form-group">
                <label for="cliDireccion">Direcci√≥n:</label>
                <input type="text" id="cliDireccion" placeholder="Calle 123">
              </div>
            </div>
            <div class="form-group">
              <label for="cliObservaciones">Observaciones:</label>
              <textarea id="cliObservaciones" placeholder="Notas adicionales..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Guardar Cliente</button>
            <div id="clienteMessage" class="message"></div>
          </form>
        </div>

        <div id="clientesList" style="margin-top: 30px;">
          <h3>Clientes Registrados</h3>
          <div id="clientesContent"></div>
        </div>
      </div>
    </section>

    <!-- Minutas Section -->
    <section id="minutas" class="section">
      <div class="card">
        <h2>üìã Gesti√≥n de Minutas</h2>
        <button class="btn btn-primary" onclick="toggleMinutaForm()">‚ûï Crear Nueva Minuta</button>
        
        <div id="minutaForm" style="display: none; margin-top: 20px;">
          <h3>Nueva Minuta</h3>
          <form id="minutaFormElement">
            <div class="form-row">
              <div class="form-group">
                <label for="minVehiculo">Veh√≠culo:</label>
                <select id="minVehiculo" required>
                  <option value="">Seleccionar veh√≠culo...</option>
                </select>
              </div>
              <div class="form-group">
                <label for="minCliente">Cliente:</label>
                <select id="minCliente" required>
                  <option value="">Seleccionar cliente...</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="minPrecioOriginal">Precio Original:</label>
                <input type="number" id="minPrecioOriginal" readonly>
              </div>
              <div class="form-group">
                <label for="minPrecioFinal">Precio Final:</label>
                <input type="number" id="minPrecioFinal" step="0.01" required>
              </div>
            </div>
            <div class="form-group">
              <label for="minObservaciones">Observaciones:</label>
              <textarea id="minObservaciones" placeholder="Detalles de la operaci√≥n..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Crear Minuta</button>
            <div id="minutaMessage" class="message"></div>
          </form>
        </div>

        <div id="minutasList" style="margin-top: 30px;">
          <h3>Minutas Activas</h3>
          <div id="minutasContent"></div>
        </div>
      </div>
    </section>

    <!-- Secci√≥n de Control de Usuarios (Solo Admin Premium) -->
    <div id="control-usuarios" class="section">
        <div class="card">
            <h2>üéõÔ∏è Panel de Control de Usuarios</h2>
            
            <!-- Estado de Usuarios en Tiempo Real -->
            <div class="usuarios-estado">
                <h3>üë• Estado de Usuarios Conectados</h3>
                <div id="usuariosConectados" class="usuarios-grid">
                    <!-- Se cargar√°n din√°micamente -->
                </div>
            </div>

            <!-- Gesti√≥n de Usuarios -->
            <div class="usuarios-gestion">
                <h3>‚öôÔ∏è Gesti√≥n de Usuarios</h3>
                <div class="usuarios-lista" id="usuariosLista">
                    <!-- Se cargar√°n din√°micamente -->
                </div>
            </div>

            <!-- Alertas y Notificaciones -->
            <div class="alertas-panel">
                <h3>üö® Alertas Recientes</h3>
                <div id="alertasRecientes" class="alertas-list">
                    <!-- Se cargar√°n din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Secci√≥n de Auditor√≠a Completa -->
    <div id="auditoria" class="section">
        <div class="card">
            <h2>üìä Auditor√≠a Completa</h2>
            
            <!-- Filtros de Auditor√≠a -->
            <div class="auditoria-filtros">
                <div class="form-row">
                    <div class="form-group">
                        <label>Usuario:</label>
                        <select id="auditUsuario">
                            <option value="">Todos los usuarios</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>M√≥dulo:</label>
                        <select id="auditModulo">
                            <option value="">Todos los m√≥dulos</option>
                            <option value="auth">Autenticaci√≥n</option>
                            <option value="vehiculos">Veh√≠culos</option>
                            <option value="clientes">Clientes</option>
                            <option value="minutas">Minutas</option>
                            <option value="usuarios">Usuarios</option>
                            <option value="sistema">Sistema</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Acci√≥n:</label>
                        <select id="auditAccion">
                            <option value="">Todas las acciones</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary" onclick="cargarAuditoria()">üîç Filtrar</button>
                    </div>
                </div>
                
                <!-- Botones de Exportaci√≥n y Respaldo -->
                <div class="export-buttons" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
                    <h4 style="margin: 0 0 15px 0; color: #495057;">üíæ Exportaci√≥n y Respaldo de Datos</h4>
                    <div class="form-row">
                        <button class="btn btn-success" onclick="exportarDatosCompletos()" style="margin-right: 10px;">
                            üì§ Exportar Datos Completos (JSON)
                        </button>
                        <button class="btn btn-info" onclick="descargarRespaldoDB()" style="margin-right: 10px;">
                            üì• Descargar Respaldo (DB)
                        </button>
                        <button class="btn btn-warning" onclick="verEstadoBackups()">
                            üìä Ver Estado de Backups
                        </button>
                    </div>
                    <p style="margin: 10px 0 0 0; font-size: 12px; color: #6c757d;">
                        üïê Los respaldos autom√°ticos se realizan cada 5 minutos. Los datos se almacenan localmente y pueden ser exportados para mayor seguridad.
                    </p>
                </div>
            </div>

            <!-- Tabla de Auditor√≠a -->
            <div class="auditoria-tabla">
                <table id="auditoriaTable">
                    <thead>
                        <tr>
                            <th>Fecha/Hora</th>
                            <th>Usuario</th>
                            <th>Acci√≥n</th>
                            <th>M√≥dulo</th>
                            <th>Detalles</th>
                            <th>IP Address</th>
                        </tr>
                    </thead>
                    <tbody id="auditoriaBody">
                        <!-- Se cargar√°n din√°micamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Secci√≥n de Pagos -->
    <div id="pagos" class="section">
        <div class="card">
            <h2>üí∞ Gesti√≥n de Pagos</h2>
            <p>Solo usuarios administrativos pueden registrar pagos recibidos.</p>
            <!-- Contenido de pagos -->
        </div>
    </div>

    <!-- Secci√≥n de Reportes -->
    <div id="reportes" class="section">
        <div class="card">
            <h2>üìà Reportes y Estad√≠sticas</h2>
            <p>Generaci√≥n de reportes detallados de ventas y actividad.</p>
            <!-- Contenido de reportes -->
        </div>
    </div>

    <!-- Modal de Suspensi√≥n de Usuario -->
    <div id="modalSuspension" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üö´ Suspender Usuario</h3>
                <span class="close" onclick="cerrarModalSuspension()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Usuario a suspender:</label>
                    <input type="text" id="suspendNombre" readonly>
                </div>
                <div class="form-group">
                    <label>Motivo de suspensi√≥n:</label>
                    <select id="suspendMotivo">
                        <option value="mala_accion">Mala acci√≥n</option>
                        <option value="mala_administracion">Mala administraci√≥n</option>
                        <option value="inactividad">Inactividad prolongada</option>
                        <option value="violacion_politicas">Violaci√≥n de pol√≠ticas</option>
                        <option value="otro">Otro (especificar)</option>
                    </select>
                </div>
                <div class="form-group" id="motivoOtroGroup" style="display:none;">
                    <label>Especificar motivo:</label>
                    <textarea id="suspendMotivoOtro" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Mensaje para el usuario:</label>
                    <textarea id="suspendMensaje" rows="4" placeholder="Este mensaje se mostrar√° al usuario cuando intente iniciar sesi√≥n."></textarea>
                </div>
                <div class="form-group">
                    <label>Duraci√≥n:</label>
                    <select id="suspendDuracion">
                        <option value="temporal">Temporal (hasta que yo lo reactive)</option>
                        <option value="1_dia">1 d√≠a</option>
                        <option value="3_dias">3 d√≠as</option>
                        <option value="1_semana">1 semana</option>
                        <option value="permanente">Permanente</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cerrarModalSuspension()">Cancelar</button>
                <button class="btn btn-danger" onclick="confirmarSuspension()">üö´ Suspender Usuario</button>
            </div>
        </div>
    </div>

    <!-- Modal de Mensaje de Usuario Suspendido -->
    <div id="modalUsuarioSuspendido" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üö´ Cuenta Suspendida</h3>
            </div>
            <div class="modal-body">
                <div class="suspension-message">
                    <div class="icono-suspension">üö´</div>
                    <h4>Tu cuenta ha sido suspendida</h4>
                    <p id="mensajeSuspension"></p>
                    <p><strong>Motivo:</strong> <span id="motivoSuspension"></span></p>
                    <p><strong>Fecha:</strong> <span id="fechaSuspension"></span></p>
                    <div class="contacto-admin">
                        <p>Para m√°s informaci√≥n, contacta al administrador del sistema.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="cerrarModalUsuarioSuspendido()">Entendido</button>
            </div>
        </div>
    </div>
  </div>

  <script>
    // Esperar a que DOM est√© listo
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOM ready');
      console.log('window.api:', window.api);
    });
  </script>
  <script src="app.js"></script>
</body>
</html>
